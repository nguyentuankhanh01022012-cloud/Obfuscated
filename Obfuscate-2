-- üåü SCRIPT CROWN BRING + GUI C√ì N√öT X ƒê√ìNG
-- C√≥ n√∫t "LOOP" (b·∫≠t/t·∫Øt auto), "BRING H·∫æT 1 L·∫¶N", v√† n√∫t X ƒë·ªÉ ƒë√≥ng GUI

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- ========== CORE BRING CROWN ==========
local GAMEPLAY_PATH = "Gameplay"
local CURRENCY_PICKUP_PATH = "CurrencyPickup"
local CURRENCY_HOLDER_PATH = "CurrencyHolder"
local CROWN_NAME = "Crown"

local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

LocalPlayer.CharacterAdded:Connect(function(newChar)
    Character = newChar
    HumanoidRootPart = newChar:WaitForChild("HumanoidRootPart")
end)

local function getCurrencyHolder()
    local gameplay = workspace:FindFirstChild(GAMEPLAY_PATH)
    if gameplay then
        local currencyPickup = gameplay:FindFirstChild(CURRENCY_PICKUP_PATH)
        if currencyPickup then
            return currencyPickup:FindFirstChild(CURRENCY_HOLDER_PATH)
        end
    end
    return nil
end

local isLoopEnabled = false
local loopConnection = nil

local function bringAllCrownsOnce()
    local holder = getCurrencyHolder()
    if not holder or not HumanoidRootPart then 
        return 0 
    end
    
    local rootCFrame = HumanoidRootPart.CFrame
    local broughtCount = 0
    
    for _, obj in ipairs(holder:GetChildren()) do
        if obj.Name == CROWN_NAME and obj.Parent == holder then
            pcall(function()
                if obj:IsA("BasePart") then
                    obj.CFrame = rootCFrame * CFrame.new(math.random(-0.4,0.4), math.random(-0.8,0.8), math.random(-0.4,0.4))
                    obj.AssemblyLinearVelocity = Vector3.new(0,0,0)
                    obj.AssemblyAngularVelocity = Vector3.new(0,0,0)
                    obj.CanCollide = false
                    broughtCount = broughtCount + 1
                elseif obj:IsA("Model") and obj.PrimaryPart then
                    obj:SetPrimaryPartCFrame(rootCFrame * CFrame.new(math.random(-0.2,0.2), 0, math.random(-0.2,0.2)))
                    broughtCount = broughtCount + 1
                elseif obj:FindFirstChildWhichIsA("BasePart") then
                    local part = obj:FindFirstChildWhichIsA("BasePart")
                    part.CFrame = rootCFrame
                    broughtCount = broughtCount + 1
                end
                
                if obj:IsA("BasePart") then
                    firetouchinterest(HumanoidRootPart, obj, 0)
                    task.wait()
                    firetouchinterest(HumanoidRootPart, obj, 1)
                end
            end)
        end
    end
    
    return broughtCount
end

local function startLoop()
    loopConnection = RunService.Heartbeat:Connect(function()
        task.wait(0.05)
        pcall(bringAllCrownsOnce)
    end)
end

local function toggleLoop(state)
    isLoopEnabled = state
    if state then
        startLoop()
    else
        if loopConnection then
            loopConnection:Disconnect()
            loopConnection = nil
        end
    end
end

-- ========== GUI ==========
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CrownBringGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 220, 0, 90)
MainFrame.Position = UDim2.new(0.5, -110, 0.2, -45)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(100, 100, 255)
UIStroke.Thickness = 1.5
UIStroke.Parent = MainFrame

-- Title
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -40, 0, 28)
Title.Position = UDim2.new(0, 10, 0, 5)
Title.BackgroundTransparency = 1
Title.Text = "Crown Bring"
Title.TextColor3 = Color3.new(1,1,1)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.Parent = MainFrame

-- N√∫t X ƒë√≥ng GUI
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseBtn"
CloseButton.Size = UDim2.new(0, 28, 0, 28)
CloseButton.Position = UDim2.new(1, -33, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.new(1,1,1)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 20
CloseButton.Parent = MainFrame

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

-- N√∫t LOOP
local LoopButton = Instance.new("TextButton")
LoopButton.Size = UDim2.new(0.45, 0, 0, 45)
LoopButton.Position = UDim2.new(0.05, 0, 0.45, 0)
LoopButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
LoopButton.Text = "LOOP\nT·∫ÆT"
LoopButton.TextColor3 = Color3.fromRGB(255, 120, 120)
LoopButton.Font = Enum.Font.GothamSemibold
LoopButton.TextSize = 16
LoopButton.Parent = MainFrame

local LoopCorner = Instance.new("UICorner")
LoopCorner.CornerRadius = UDim.new(0, 8)
LoopCorner.Parent = LoopButton

-- N√∫t Bring 1 l·∫ßn
local OnceButton = Instance.new("TextButton")
OnceButton.Size = UDim2.new(0.45, 0, 0, 45)
OnceButton.Position = UDim2.new(0.5, 0, 0.45, 0)
OnceButton.BackgroundColor3 = Color3.fromRGB(50, 150, 80)
OnceButton.Text = "BRING\nH·∫æT 1 L·∫¶N"
OnceButton.TextColor3 = Color3.new(1,1,1)
OnceButton.Font = Enum.Font.GothamSemibold
OnceButton.TextSize = 16
OnceButton.Parent = MainFrame

local OnceCorner = Instance.new("UICorner")
OnceCorner.CornerRadius = UDim.new(0, 8)
OnceCorner.Parent = OnceButton

-- ========== EVENT ==========

-- N√∫t X - ƒê√≥ng GUI
CloseButton.MouseButton1Click:Connect(function()
    if loopConnection then
        loopConnection:Disconnect()
    end
    ScreenGui:Destroy()
    print("GUI ƒë√£ ƒë∆∞·ª£c ƒë√≥ng")
end)

-- N√∫t LOOP
LoopButton.MouseButton1Click:Connect(function()
    toggleLoop(not isLoopEnabled)
    if isLoopEnabled then
        LoopButton.BackgroundColor3 = Color3.fromRGB(40, 120, 40)
        LoopButton.Text = "LOOP\nB·∫¨T"
        LoopButton.TextColor3 = Color3.fromRGB(150, 255, 150)
    else
        LoopButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        LoopButton.Text = "LOOP\nT·∫ÆT"
        LoopButton.TextColor3 = Color3.fromRGB(255, 120, 120)
    end
end)

-- N√∫t Bring 1 l·∫ßn
OnceButton.MouseButton1Click:Connect(function()
    local count = bringAllCrownsOnce()
    print("ƒê√£ bring " .. count .. " Crown")
    
    -- Hi·ªáu ·ª©ng nh·∫•n n√∫t
    local originalColor = OnceButton.BackgroundColor3
    OnceButton.BackgroundColor3 = Color3.fromRGB(80, 220, 110)
    task.delay(0.2, function()
        OnceButton.BackgroundColor3 = originalColor
    end)
end)

-- Hover effect nh·∫π cho n√∫t X
CloseButton.MouseEnter:Connect(function()
    CloseButton.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
end)
CloseButton.MouseLeave:Connect(function()
    CloseButton.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
end)

print("GUI Crown Bring ƒë√£ m·ªü - c√≥ n√∫t X ƒë·ªÉ ƒë√≥ng")
